<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hostel Room Allocation System</title>
    <style>
      /* Global Styles */
      :root {
        --primary: #0c4da2;
        --primary-dark: #08367a;
        --secondary: #d8bd53;
        --secondary-dark: #b89c3a;
        --accent: #d8bd53;
        --border-color: #e4b316;
        --danger: #e74c3c;
        --gray: #6c757d;

        /* Light Theme Colors */
        --theme-bg-color: #f5f7fa;
        --theme-text-color: #333333;
        --theme-card-bg-color: #ffffff;
        --theme-border-color: #dee2e6;
        --theme-input-bg-color: #ffffff;
        --theme-input-border-color: var(--border-color);
        --theme-box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        --theme-sidebar-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        --theme-nav-hover-bg: rgba(37, 150, 190, 0.05);
        --theme-nav-active-bg: rgba(37, 150, 190, 0.1);
        --theme-table-header-bg: rgba(37, 150, 190, 0.1);
        --theme-status-card-bg: rgba(12, 77, 162, 0.1);
        --theme-room-available-bg: rgba(216, 189, 83, 0.2);
        --theme-room-available-text: #534411;
        --theme-room-occupied-bg: rgba(231, 76, 60, 0.1);
        --theme-room-occupied-text: #721c24;
        --theme-success-bg: rgba(39, 174, 96, 0.1);
        --theme-success-border: #27ae60;
        --theme-success-text: #27ae60;
        --theme-error-bg: rgba(231, 76, 60, 0.1);
        --theme-error-border: var(--danger);
        --theme-error-text: var(--danger);
        --theme-chatbot-bot-bg: #f2f2f2;
      }

      body.dark-theme {
        --primary: #2596be;
        --primary-dark: #0c4da2;
        --secondary: #d8bd53;
        --secondary-dark: #b89c3a;
        --border-color: #e4b316;
        --gray: #9e9e9e;
        --danger: #ef5350;

        /* Dark Theme Colors */
        --theme-bg-color: #121212;
        --theme-text-color: #e0e0e0;
        --theme-card-bg-color: #1e1e1e;
        --theme-border-color: #444;
        --theme-input-bg-color: #2c2c2c;
        --theme-input-border-color: #555;
        --theme-box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
        --theme-sidebar-shadow: 2px 0 5px rgba(0, 0, 0, 0.4);
        --theme-nav-hover-bg: rgba(37, 150, 190, 0.15);
        --theme-nav-active-bg: rgba(37, 150, 190, 0.25);
        --theme-table-header-bg: #2a2a3a;
        --theme-status-card-bg: rgba(37, 150, 190, 0.1);
        --theme-room-available-bg: rgba(201, 179, 92, 0.882);
        --theme-room-available-text: #af9011fe;
        --theme-room-occupied-bg: rgba(231, 76, 60, 0.15);
        --theme-room-occupied-text: #e74c3c;
        --theme-success-bg: rgba(39, 174, 96, 0.15);
        --theme-success-border: #27ae60;
        --theme-success-text: #66bb6a;
        --theme-error-bg: rgba(231, 76, 60, 0.15);
        --theme-error-border: var(--danger);
        --theme-error-text: #ef5350;
        --theme-chatbot-bot-bg: #3a3a3a;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--theme-bg-color);
        color: var(--theme-text-color);
        line-height: 1.6;
        display: flex; /* Changed for sidebar layout */
        transition: background-color 0.3s, color 0.3s;
      }

      .container {
        width: 100%; /* Adjusted for new layout */
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 15px;
      }

      .card {
        background: var(--theme-card-bg-color);
        border-radius: 8px;
        box-shadow: var(--theme-box-shadow);
        padding: 20px;
        margin-bottom: 20px;
        border: 2px solid var(--border-color);
      }

      .btn {
        display: inline-block;
        padding: 10px 20px;
        background-color: var(--primary);
        color: #ffffff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        text-align: center;
        font-size: 16px;
        transition: all 0.3s ease;
        position: relative;
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-5px);
        }
        100% {
          transform: translateY(0px);
        }
      }

      .btn:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .btn-secondary {
        background-color: var(--secondary);
        color: #333;
      }

      .btn-secondary:hover {
        background-color: var(--secondary-dark);
      }

      .btn-danger {
        background-color: var(--danger);
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }

      .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--theme-input-border-color);
        background-color: var(--theme-input-bg-color);
        color: var(--theme-text-color);
        border-radius: 4px;
        font-size: 16px;
      }

      select.form-control {
        height: 42px;
      }

      /* Sidebar Styles */
      .sidebar {
        width: 260px;
        height: 100vh;
        background-color: var(--theme-card-bg-color);
        box-shadow: var(--theme-sidebar-shadow);
        position: fixed;
        top: 0;
        left: 0;
        z-index: 100;
        border-right: 3px solid var(--border-color);
        padding: 20px;
        display: flex;
        flex-direction: column;
      }

      .navbar {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        flex-grow: 1; /* Makes the navbar fill the sidebar */
      }

      .logo {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary);
        text-decoration: none;
        margin-bottom: 30px;
        padding-bottom: 15px;
        width: 100%;
      }

      .nav-links {
        display: flex;
        flex-direction: column;
        list-style: none;
        width: 100%;
      }

      .nav-links li {
        margin-left: 0;
        margin-bottom: 10px;
        width: 100%;
      }

      .nav-links a {
        display: block;
        text-decoration: none;
        color: var(--theme-text-color);
        font-weight: 500;
        transition: all 0.3s;
        padding: 12px 15px;
        border-radius: 6px;
        border: 1px solid transparent;
      }

      .nav-links a:hover {
        color: var(--primary);
        background-color: var(--theme-nav-hover-bg);
        border-left: 4px solid var(--border-color);
      }

      .nav-links a.active {
        color: var(--primary);
        background-color: var(--theme-nav-active-bg);
        border-left: 4px solid var(--primary);
        font-weight: 600;
      }

      /* Main Content Wrapper */
      .main-content-wrapper {
        margin-left: 260px; /* Same as sidebar width */
        width: calc(100% - 260px);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      main {
        padding: 30px;
        flex-grow: 1; /* Pushes footer down */
      }

      .page-title {
        margin-bottom: 20px;
        color: var(--theme-text-color);
        font-weight: 600;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--border-color);
      }

      /* Footer */
      footer {
        background-color: var(--primary);
        color: #ffffff;
        padding: 20px 0;
        text-align: center;
        border-top: 3px solid var(--border-color);
      }

      /* Authentication Pages */
      .auth-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 80vh;
      }

      .auth-card {
        width: 100%;
        max-width: 400px;
        border: 3px solid var(--border-color);
      }

      .auth-tabs {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 2px solid var(--border-color);
      }
      .tab-btn {
        flex: 1;
        padding: 12px;
        background: none;
        border: none;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        color: var(--gray);
        transition: all 0.3s ease;
        border-bottom: 3px solid transparent;
      }
      .tab-btn.active {
        color: var(--primary);
        border-bottom: 3px solid var(--primary);
      }

      /* Error/Success Messages */
      .error-message {
        color: var(--theme-error-text);
        text-align: center;
        margin-top: 10px;
        padding: 10px;
        background-color: var(--theme-error-bg);
        border: 1px solid var(--theme-error-border);
        border-radius: 4px;
        animation: pop-in 0.3s ease-out;
      }

      .success-message {
        color: var(--theme-success-text);
        text-align: center;
        margin-top: 10px;
        padding: 10px;
        background-color: var(--theme-success-bg);
        border: 1px solid var(--theme-success-border);
        border-radius: 4px;
        animation: pop-in 0.3s ease-out;
      }

      @keyframes pop-in {
        0% {
          opacity: 0;
          transform: scale(0.8);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      /* Dashboard */
      .welcome-section {
        margin-bottom: 30px;
      }

      .status-card {
        background-color: var(--theme-status-card-bg);
        border-left: 4px solid var(--border-color);
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid var(--border-color);
      }

      .status-card h3 {
        margin-bottom: 10px;
        color: var(--theme-text-color);
      }

      .status-card p {
        margin-bottom: 5px;
      }

      .dashboard-actions {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }

      .action-card {
        background-color: var(--theme-card-bg-color);
        border-radius: 8px;
        box-shadow: var(--theme-box-shadow);
        padding: 20px;
        text-align: center;
        transition: transform 0.3s;
        border: 2px solid var(--border-color);
      }

      .action-card:hover {
        transform: translateY(-5px);
        border-color: var(--primary);
      }

      .action-card h3 {
        margin-bottom: 10px;
        color: var(--theme-text-color);
      }

      .action-card p {
        margin-bottom: 15px;
        color: var(--gray);
      }

      /* Room Registration */
      .room-availability {
        margin-top: 20px;
      }

      .availability-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        border: 2px solid var(--border-color);
      }

      .availability-table th,
      .availability-table td {
        border: 1px solid var(--border-color);
        padding: 10px;
        text-align: center;
      }

      .availability-table th {
        background-color: var(--theme-table-header-bg);
      }

      .room-available {
        background-color: var(--theme-room-available-bg);
        color: var(--theme-room-available-text);
      }

      .room-occupied {
        background-color: var(--theme-room-occupied-bg);
        color: var(--theme-room-occupied-text);
      }

      /* Profile */
      .profile-info {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
      }

      .info-group {
        margin-bottom: 15px;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 4px;
      }

      .info-group label {
        font-weight: 600;
        color: var(--gray);
        display: block;
        margin-bottom: 5px;
      }

      .info-group p {
        font-size: 16px;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: var(--theme-card-bg-color);
        padding: 20px;
        border-radius: 8px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        border: 3px solid var(--border-color);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--border-color);
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--gray);
      }

      /* Admin Panel */
      .admin-panel {
        margin-top: 20px;
      }

      .admin-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        border: 2px solid var(--border-color);
      }

      .admin-table th,
      .admin-table td {
        border: 1px solid var(--border-color);
        padding: 10px;
        text-align: left;
      }

      .admin-table th {
        background-color: var(--theme-table-header-bg);
      }

      /* Theme Switcher */
      .theme-switcher-container {
        margin-top: auto;
        padding-top: 20px;
        border-top: 1px solid var(--theme-border-color);
        display: flex;
        justify-content: center;
      }
      .theme-switcher {
        background: var(--theme-bg-color);
        border: 1px solid var(--theme-border-color);
        border-radius: 8px;
        width: 100%;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .theme-switcher:hover {
        border-color: var(--primary);
        background-color: var(--theme-nav-hover-bg);
      }
      .theme-switcher svg {
        color: var(--theme-text-color);
        transition: color 0.3s ease;
      }

      /* Chatbot Styles */
      .chatbot-toggler {
        position: fixed;
        bottom: 30px;
        right: 35px;
        width: 60px;
        height: 60px;
        background: var(--primary);
        color: #ffffff;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        z-index: 1001;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: transform 0.3s ease;
      }
      .chatbot-toggler:hover {
        transform: scale(1.1);
      }
      .chatbot-container {
        position: fixed;
        bottom: 100px;
        right: 35px;
        width: 350px;
        background: var(--theme-card-bg-color);
        border-radius: 15px;
        box-shadow: 0 0 128px 0 rgba(0, 0, 0, 0.1),
          0 32px 64px -48px rgba(0, 0, 0, 0.5);
        transform: scale(0.5);
        opacity: 0;
        pointer-events: none;
        transition: all 0.2s ease;
        transform-origin: bottom right;
        z-index: 1000;
      }
      .chatbot-container.active {
        transform: scale(1);
        opacity: 1;
        pointer-events: auto;
      }
      .chatbot-header {
        background: var(--primary);
        color: #ffffff;
        padding: 16px 20px;
        text-align: center;
        border-radius: 15px 15px 0 0;
        position: relative;
      }
      .chatbot-header h2 {
        font-size: 1.4rem;
      }
      .chatbot-close-btn {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #ffffff;
        font-size: 1.5rem;
        cursor: pointer;
      }
      .chatbot-messages {
        height: 300px;
        overflow-y: auto;
        padding: 20px;
      }
      .chat-message {
        display: flex;
        margin-bottom: 15px;
      }
      .chat-message.bot .message {
        background: var(--theme-chatbot-bot-bg);
        color: var(--theme-text-color);
      }
      .chat-message.user .message {
        background: var(--primary);
        color: #ffffff;
        margin-left: auto;
      }
      .message {
        padding: 10px 15px;
        border-radius: 18px;
        max-width: 80%;
        font-size: 0.95rem;
        line-height: 1.4;
      }
      .chat-message.bot .typing-indicator {
        background: var(--theme-chatbot-bot-bg);
        padding: 10px 15px;
        border-radius: 18px;
      }
      .typing-indicator {
        display: flex;
        align-items: center;
      }
      .typing-indicator span {
        height: 8px;
        width: 8px;
        border-radius: 50%;
        background-color: var(--gray);
        animation: typing 1s infinite;
        margin: 0 2px;
      }
      .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes typing {
        0% {
          transform: translateY(0);
        }
        25% {
          transform: translateY(-5px);
        }
        50% {
          transform: translateY(0);
        }
      }
      .chatbot-input {
        display: flex;
        gap: 5px;
        padding: 15px 20px;
        border-top: 1px solid var(--theme-border-color);
      }
      #chatbot-input-field {
        flex: 1;
        height: 45px;
        border: 1px solid var(--theme-border-color);
        background: var(--theme-input-bg-color);
        color: var(--theme-text-color);
        border-radius: 6px;
        padding: 0 15px;
        font-size: 1rem;
        outline: none;
      }
      #chatbot-send-btn {
        width: 45px;
        height: 45px;
        border: none;
        border-radius: 6px;
        background: var(--primary);
        color: #ffffff;
        cursor: pointer;
        font-size: 1.2rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        body {
          flex-direction: column;
        }
        .sidebar {
          width: 100%;
          height: auto;
          position: relative;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
          border-right: none;
          border-bottom: 3px solid var(--border-color);
        }
        .navbar {
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
        }
        .nav-links {
          flex-direction: row;
          margin-top: 0;
          width: auto;
        }
        .nav-links li {
          margin-bottom: 0;
          margin-left: 10px;
        }
        .main-content-wrapper {
          margin-left: 0;
          width: 100%;
        }

        .chatbot-container {
          right: 0;
          bottom: 0;
          width: 100%;
          height: 100%;
          border-radius: 0;
        }
        .chatbot-messages {
          height: 80vh;
        }
        
        .theme-switcher-container {
            display: none; /* Hide theme switcher in mobile nav for simplicity */
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <aside class="sidebar">
      <nav class="navbar">
        <div>
            <a href="#" class="logo">Hostel Allocation</a>
            <ul class="nav-links">
            <li>
                <a href="#" class="nav-link" data-page="auth">Login / Sign Up</a>
            </li>
            <li>
                <a href="#" class="nav-link" data-page="dashboard">Dashboard</a>
            </li>
            <li>
                <a href="#" class="nav-link" data-page="registration"
                >Room Registration</a
                >
            </li>
            <li>
                <a href="#" class="nav-link" data-page="allotment"
                >Allotment Result</a
                >
            </li>
            <li>
                <a href="#" class="nav-link" data-page="profile">Profile</a>
            </li>
            <li><a href="#" class="nav-link" data-page="admin">Admin</a></li>
            </ul>
        </div>

        <!-- THEME SWITCHER -->
        <div class="theme-switcher-container">
            <button id="theme-switcher" class="theme-switcher" aria-label="Toggle theme">
                <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            </button>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content-wrapper">
      <main>
        <div class="container">
          <!-- Unified Auth Page -->
          <div id="auth-page" class="page">
            <div class="auth-container">
              <div class="card auth-card">
                <div class="auth-tabs">
                  <button id="login-tab-btn" class="tab-btn active">
                    Login
                  </button>
                  <button id="signup-tab-btn" class="tab-btn">Sign Up</button>
                </div>

                <!-- Login Form Container -->
                <div id="login-form-container">
                  <form id="login-form">
                    <div class="form-group">
                      <label for="login-email">Email</label>
                      <input
                        type="email"
                        id="login-email"
                        class="form-control"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label for="login-password">Password</label>
                      <input
                        type="password"
                        id="login-password"
                        class="form-control"
                        required
                      />
                    </div>
                    <button type="submit" class="btn" style="width: 100%">
                      Login
                    </button>
                  </form>
                  <div
                    id="login-error"
                    class="error-message"
                    style="display: none"
                  >
                    Email not found. Please sign up first.
                  </div>
                </div>

                <!-- Sign Up Form Container -->
                <div id="signup-form-container" style="display: none">
                  <form id="signup-form">
                    <div class="form-group">
                      <label for="signup-name">Full Name</label>
                      <input
                        type="text"
                        id="signup-name"
                        class="form-control"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label for="signup-email">Email</label>
                      <input
                        type="email"
                        id="signup-email"
                        class="form-control"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label for="signup-password">Password</label>
                      <input
                        type="password"
                        id="signup-password"
                        class="form-control"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label for="signup-gender">Gender</label>
                      <select id="signup-gender" class="form-control" required>
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                      </select>
                    </div>
                    <button type="submit" class="btn" style="width: 100%">
                      Register
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <!-- Dashboard Page -->
          <div id="dashboard-page" class="page" style="display: none">
            <h1 class="page-title">Student Dashboard</h1>
            <div class="welcome-section card">
              <h2 id="welcome-message">Welcome, Student</h2>
            </div>
            <div class="status-card">
              <h3>Allocation Status</h3>
              <p id="allocation-status">Not Registered</p>
              <p id="room-details" style="display: none">
                Room: <span id="room-number"></span>
              </p>
            </div>
            <div class="dashboard-actions">
              <div class="action-card">
                <h3>Room Registration</h3>
                <p>Register for hostel room allocation</p>
                <a href="#" class="btn nav-link" data-page="registration"
                  >Register</a
                >
              </div>
              <div class="action-card">
                <h3>Allotment Result</h3>
                <p>Check your room allotment status</p>
                <a href="#" class="btn nav-link" data-page="allotment"
                  >Check Result</a
                >
              </div>
              <div class="action-card">
                <h3>Profile</h3>
                <p>View and edit your profile</p>
                <a href="#" class="btn nav-link" data-page="profile"
                  >View Profile</a
                >
              </div>
              <div class="action-card">
                <h3>Logout</h3>
                <p>Logout from your account</p>
                <button class="btn btn-danger" id="logout-btn">Logout</button>
              </div>
            </div>
          </div>

          <!-- Room Registration Page -->
          <div id="registration-page" class="page" style="display: none">
            <h1 class="page-title">Room Registration</h1>
            <div class="card">
              <form id="registration-form">
                <div class="form-group">
                  <label for="hostel-block">Hostel Block</label>
                  <select id="hostel-block" class="form-control" required>
                    <option value="">Select Hostel Block</option>
                    <option value="omv">OMV</option>
                    <option value="bh2">BH-2</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="room-type">Room Type/Preferences</label>
                  <select id="room-type" class="form-control" required>
                    <option value="">Select Room Type</option>
                    <option value="single">Single Occupancy</option>
                    <option value="double">Double Occupancy</option>
                    <option value="triple">Triple Occupancy</option>
                  </select>
                </div>
                <button type="submit" class="btn">Submit Registration</button>
              </form>
              <div
                id="registration-success"
                class="success-message"
                style="display: none"
              >
                Registration submitted successfully!
              </div>
              <div
                id="registration-error"
                class="error-message"
                style="display: none"
              >
                Error submitting registration. Please try again.
              </div>
            </div>
            <div class="card room-availability">
              <h3>Room Availability</h3>
              <div id="omv-availability" style="display: none">
                <h4>OMV Hostel</h4>
                <table class="availability-table">
                  <thead>
                    <tr>
                      <th>Room Range</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="omv-availability-body">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
              <div id="bh2-availability" style="display: none">
                <h4>BH-2 Hostel</h4>
                <table class="availability-table">
                  <thead>
                    <tr>
                      <th>Floor</th>
                      <th>Rooms</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="bh2-availability-body">
                    <!-- Will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Allotment Result Page -->
          <div id="allotment-page" class="page" style="display: none">
            <h1 class="page-title">Room Allotment Result</h1>
            <div class="card">
              <div id="allotment-result">
                <h3>Your Room Allotment Status</h3>
                <p id="allotment-message">
                  You have not been allotted a room yet.
                </p>
                <div id="allotted-room" style="display: none">
                  <p>
                    <strong>Room Number:</strong>
                    <span id="allotted-room-number"></span>
                  </p>
                  <p>
                    <strong>Hostel Block:</strong>
                    <span id="allotted-hostel-block"></span>
                  </p>
                  <p>
                    <strong>Room Type:</strong>
                    <span id="allotted-room-type"></span>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Profile Page -->
          <div id="profile-page" class="page" style="display: none">
            <h1 class="page-title">Student Profile</h1>
            <div class="card">
              <div class="profile-info">
                <div>
                  <div class="info-group">
                    <label>Name</label>
                    <p id="profile-name">John Doe</p>
                  </div>
                  <div class="info-group">
                    <label>Email</label>
                    <p id="profile-email">john.doe@example.com</p>
                  </div>
                  <div class="info-group">
                    <label>Gender</label>
                    <p id="profile-gender">Male</p>
                  </div>
                </div>
                <div>
                  <div class="info-group">
                    <label>Room Status</label>
                    <p id="profile-room-status">Not Registered</p>
                  </div>
                  <div
                    class="info-group"
                    id="profile-room-details"
                    style="display: none"
                  >
                    <label>Allotted Room</label>
                    <p id="profile-room-number">N/A</p>
                  </div>
                </div>
              </div>
              <div style="margin-top: 20px">
                <button class="btn" id="edit-profile-btn">Edit Profile</button>
                <button
                  class="btn btn-danger"
                  id="profile-logout-btn"
                  style="float: right"
                >
                  Logout
                </button>
              </div>
            </div>
          </div>

          <!-- Admin Page -->
          <div id="admin-page" class="page" style="display: none">
            <h1 class="page-title">Admin Panel</h1>
            <div class="card">
              <h3>Room Allotment</h3>
              <p>Allot rooms to registered students</p>
              <button class="btn" id="allot-rooms-btn">Allot Rooms</button>
              <div
                id="allotment-result-message"
                class="success-message"
                style="display: none; margin-top: 15px"
              >
                <!-- Will be populated by JavaScript -->
              </div>
            </div>
            <div class="card admin-panel">
              <h3>Student Registrations</h3>
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Hostel Block</th>
                    <th>Room Type</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="admin-registrations-body">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
            <div class="card admin-panel">
              <h3>Room Allotments</h3>
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Hostel Block</th>
                    <th>Room Type</th>
                    <th>Room Number</th>
                  </tr>
                </thead>
                <tbody id="admin-allotments-body">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
      <!-- Footer -->
      <footer>
        <div class="container">
          <p>&copy; 2023 Hostel Room Allocation System. All rights reserved.</p>
        </div>
      </footer>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Profile</h2>
          <button class="modal-close">&times;</button>
        </div>
        <form id="edit-profile-form">
          <div class="form-group">
            <label for="edit-name">Full Name</label>
            <input type="text" id="edit-name" class="form-control" required />
          </div>
          <div class="form-group">
            <label for="edit-email">Email</label>
            <input type="email" id="edit-email" class="form-control" required />
          </div>
          <div class="form-group">
            <label for="edit-gender">Gender</label>
            <select id="edit-gender" class="form-control" required>
              <option value="">Select Gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>
          <button type="submit" class="btn">Save Changes</button>
        </form>
      </div>
    </div>

    <!-- Chatbot -->
    <button class="chatbot-toggler">
      <span>&#x1F4AC;</span>
    </button>
    <div class="chatbot-container">
      <div class="chatbot-header">
        <h2>Hostel Helper!</h2>
        <button class="chatbot-close-btn">&times;</button>
      </div>
      <div class="chatbot-messages">
        <div class="chat-message bot">
          <div class="message">Hi there! How can I help you today?</div>
        </div>
      </div>
      <div class="chatbot-input">
        <input
          type="text"
          id="chatbot-input-field"
          placeholder="Ask a question..."
        />
        <button id="chatbot-send-btn">&#x27A4;</button>
      </div>
    </div>

    <script>
      // Application State
      const state = {
        currentUser: null,
        users: [],
        registrations: [],
        allotments: [],
        rooms: {
          omv: {
            "001-020": { total: 20, available: 20 },
            "100-120": { total: 20, available: 20 },
            "200-220": { total: 20, available: 20 },
          },
          bh2: {
            floor1: { total: 20, available: 20 },
            floor2: { total: 20, available: 20 },
            floor3: { total: 20, available: 20 },
            floor4: { total: 20, available: 20 },
          },
        },
        chatHistory: [], // To store conversation context
      };

      // --- IMPORTANT: PASTE YOUR OPENROUTER API KEY HERE ---
      const OPENROUTER_API_KEY = "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";
      // ---

      // DOM Elements
      const pages = document.querySelectorAll(".page");
      const navLinks = document.querySelectorAll(".nav-link");

      // Auth Page elements
      const loginTabBtn = document.getElementById("login-tab-btn");
      const signupTabBtn = document.getElementById("signup-tab-btn");
      const loginFormContainer = document.getElementById("login-form-container");
      const signupFormContainer =
        document.getElementById("signup-form-container");
      const loginForm = document.getElementById("login-form");
      const signupForm = document.getElementById("signup-form");
      const loginError = document.getElementById("login-error");

      const registrationForm = document.getElementById("registration-form");
      const editProfileForm = document.getElementById("edit-profile-form");
      const hostelBlockSelect = document.getElementById("hostel-block");
      const editProfileBtn = document.getElementById("edit-profile-btn");
      const logoutBtn = document.getElementById("logout-btn");
      const profileLogoutBtn = document.getElementById("profile-logout-btn");
      const editProfileModal = document.getElementById("edit-profile-modal");
      const modalClose = document.querySelector(".modal-close");
      const allotRoomsBtn = document.getElementById("allot-rooms-btn");

      // Chatbot elements
      const chatbotToggler = document.querySelector(".chatbot-toggler");
      const chatbotContainer = document.querySelector(".chatbot-container");
      const chatbotCloseBtn = document.querySelector(".chatbot-close-btn");
      const chatbotMessages = document.querySelector(".chatbot-messages");
      const chatbotInputField = document.getElementById("chatbot-input-field");
      const chatbotSendBtn = document.getElementById("chatbot-send-btn");

      // Theme Switcher elements
      const themeSwitcher = document.getElementById("theme-switcher");
      const themeIconMoon = document.getElementById("theme-icon-moon");
      const themeIconSun = document.getElementById("theme-icon-sun");

      // Initialize the application
      function init() {
        // Apply saved theme
        const savedTheme = localStorage.getItem("theme") || "light";
        applyTheme(savedTheme);

        // Load data from localStorage with error handling
        try {
          state.users = JSON.parse(localStorage.getItem("users")) || [];
          state.registrations =
            JSON.parse(localStorage.getItem("registrations")) || [];
          state.allotments =
            JSON.parse(localStorage.getItem("allotments")) || [];

          // Check if user is logged in
          const loggedInUser = localStorage.getItem("currentUser");
          if (loggedInUser) {
            state.currentUser = JSON.parse(loggedInUser);
            showPage("dashboard");
            updateDashboard();
          } else {
            showPage("auth"); // Default to the new auth page
          }
        } catch (error) {
          console.error("Error loading data from localStorage:", error);
          // Reset data if corrupted
          state.users = [];
          state.registrations = [];
          state.allotments = [];
          localStorage.clear();
          showPage("auth");
        }

        // Set up event listeners
        setupEventListeners();

        // Update room availability based on allotments
        updateRoomAvailability();
      }

      // Set up event listeners
      function setupEventListeners() {
        // Navigation
        navLinks.forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            const page = link.getAttribute("data-page");

            // Check if user is logged in for protected pages
            if (
              [
                "dashboard",
                "registration",
                "allotment",
                "profile",
                "admin",
              ].includes(page) &&
              !state.currentUser
            ) {
              showPage("auth"); // Redirect to auth page if not logged in
              return;
            }

            showPage(page);
          });
        });

        // Auth Tabs
        loginTabBtn.addEventListener("click", () => switchAuthTab("login"));
        signupTabBtn.addEventListener("click", () => switchAuthTab("signup"));

        // Authentication forms
        loginForm.addEventListener("submit", handleLogin);
        signupForm.addEventListener("submit", handleSignup);

        // Room registration
        registrationForm.addEventListener("submit", handleRegistration);

        // Hostel block change
        hostelBlockSelect.addEventListener(
          "change",
          updateRoomAvailabilityDisplay
        );

        // Edit profile
        editProfileBtn.addEventListener("click", showEditProfileModal);
        editProfileForm.addEventListener("submit", handleEditProfile);

        // Logout buttons
        logoutBtn.addEventListener("click", handleLogout);
        profileLogoutBtn.addEventListener("click", handleLogout);

        // Modal close
        modalClose.addEventListener("click", () => {
          editProfileModal.style.display = "none";
        });

        // Admin room allotment
        allotRoomsBtn.addEventListener("click", handleAllotRooms);

        // Chatbot Listeners
        chatbotToggler.addEventListener("click", () =>
          chatbotContainer.classList.toggle("active")
        );
        chatbotCloseBtn.addEventListener("click", () => {
          chatbotContainer.classList.remove("active");
          state.chatHistory = []; // Reset history when closing
        });
        chatbotSendBtn.addEventListener("click", handleChatMessage);
        chatbotInputField.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            handleChatMessage();
          }
        });
        
        // Theme switcher
        themeSwitcher.addEventListener("click", handleThemeSwitch);

        // Close modal when clicking outside
        window.addEventListener("click", (e) => {
          if (e.target === editProfileModal) {
            editProfileModal.style.display = "none";
          }
        });
      }
      
      // Handle theme switching
      function handleThemeSwitch() {
        const currentTheme = document.body.classList.contains("dark-theme") ? "dark" : "light";
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        localStorage.setItem("theme", newTheme);
        applyTheme(newTheme);
      }
      
      // Apply theme to the UI
      function applyTheme(theme) {
        if (theme === "dark") {
            document.body.classList.add("dark-theme");
            themeIconMoon.style.display = "none";
            themeIconSun.style.display = "block";
        } else {
            document.body.classList.remove("dark-theme");
            themeIconMoon.style.display = "block";
            themeIconSun.style.display = "none";
        }
      }

      // Function to switch between Login and Sign Up tabs
      function switchAuthTab(tab) {
        if (tab === "login") {
          loginTabBtn.classList.add("active");
          signupTabBtn.classList.remove("active");
          loginFormContainer.style.display = "block";
          signupFormContainer.style.display = "none";
        } else {
          loginTabBtn.classList.remove("active");
          signupTabBtn.classList.add("active");
          loginFormContainer.style.display = "none";
          signupFormContainer.style.display = "block";
        }
        // Hide any previous error messages
        loginError.style.display = "none";
      }

      // Show specific page and hide others
      function showPage(pageName) {
        pages.forEach((page) => {
          page.style.display = "none";
        });

        document.getElementById(`${pageName}-page`).style.display = "block";

        // Update active nav link
        navLinks.forEach((link) => {
          const linkPage = link.getAttribute("data-page");
          // Highlight "Login / Sign Up" for the auth page
          if (linkPage === pageName || (pageName === "auth" && linkPage === "auth")) {
            link.classList.add("active");
          } else {
            link.classList.remove("active");
          }
        });

        // When showing auth page, default to login tab
        if (pageName === "auth") {
          switchAuthTab("login");
        }

        // Update page-specific content
        if (pageName === "dashboard") {
          updateDashboard();
        } else if (pageName === "allotment") {
          updateAllotmentResult();
        } else if (pageName === "profile") {
          updateProfile();
        } else if (pageName === "registration") {
          updateRoomAvailabilityDisplay();
        } else if (pageName === "admin") {
          updateAdminPanel();
        }
      }

      // Handle login
      function handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById("login-email").value;
        const password = document.getElementById("login-password").value;

        const user = state.users.find(
          (u) => u.email === email && u.password === password
        );

        if (user) {
          state.currentUser = user;
          localStorage.setItem("currentUser", JSON.stringify(user));
          showPage("dashboard");
          updateDashboard();
          loginError.style.display = "none";
        } else {
          // Check if email exists
          const emailExists = state.users.find((u) => u.email === email);
          if (!emailExists) {
            loginError.textContent = "Email not found. Please sign up first.";
          } else {
            loginError.textContent = "Invalid password. Please try again.";
          }
          loginError.style.display = "block";
        }
      }

      // Handle signup
      function handleSignup(e) {
        e.preventDefault();
        const name = document.getElementById("signup-name").value;
        const email = document.getElementById("signup-email").value;
        const password = document.getElementById("signup-password").value;
        const gender = document.getElementById("signup-gender").value;

        // Check if user already exists
        if (state.users.find((u) => u.email === email)) {
          alert("User with this email already exists");
          return;
        }

        const newUser = {
          id: Date.now().toString(),
          name,
          email,
          password,
          gender,
        };

        state.users.push(newUser);
        localStorage.setItem("users", JSON.stringify(state.users));

        alert("Registration successful! Please login.");
        switchAuthTab("login"); // Switch to login tab after successful registration
      }

      // Handle room registration
      function handleRegistration(e) {
        e.preventDefault();
        if (!state.currentUser) {
          alert("Please login first");
          showPage("auth");
          return;
        }

        const hostelBlock = document.getElementById("hostel-block").value;
        const roomType = document.getElementById("room-type").value;

        // Check if user already has a registration
        const existingRegistrationIndex = state.registrations.findIndex(
          (r) => r.userId === state.currentUser.id
        );

        if (existingRegistrationIndex !== -1) {
          // Update existing registration
          state.registrations[existingRegistrationIndex].hostelBlock =
            hostelBlock;
          state.registrations[existingRegistrationIndex].roomType = roomType;
          state.registrations[existingRegistrationIndex].status = "waiting";
        } else {
          // Create new registration
          const registration = {
            id: Date.now().toString(),
            userId: state.currentUser.id,
            hostelBlock,
            roomType,
            status: "waiting",
          };

          state.registrations.push(registration);
        }

        localStorage.setItem(
          "registrations",
          JSON.stringify(state.registrations)
        );

        document.getElementById("registration-success").style.display = "block";
        document.getElementById("registration-error").style.display = "none";

        setTimeout(() => {
          showPage("dashboard");
          updateDashboard();
        }, 1500);
      }

      // Update room availability display
      function updateRoomAvailabilityDisplay() {
        const hostelBlock = hostelBlockSelect.value;
        document.getElementById("omv-availability").style.display =
          hostelBlock === "omv" ? "block" : "none";
        document.getElementById("bh2-availability").style.display =
          hostelBlock === "bh2" ? "block" : "none";

        // Update OMV availability table
        const omvBody = document.getElementById("omv-availability-body");
        omvBody.innerHTML = "";

        for (const [range, data] of Object.entries(state.rooms.omv)) {
          const row = document.createElement("tr");
          const rangeCell = document.createElement("td");
          rangeCell.textContent = range;

          const statusCell = document.createElement("td");
          statusCell.textContent =
            data.available > 0 ? "Available" : "Occupied";
          statusCell.className =
            data.available > 0 ? "room-available" : "room-occupied";

          row.appendChild(rangeCell);
          row.appendChild(statusCell);
          omvBody.appendChild(row);
        }

        // Update BH-2 availability table
        const bh2Body = document.getElementById("bh2-availability-body");
        bh2Body.innerHTML = "";

        let floorNum = 1;
        for (const [floor, data] of Object.entries(state.rooms.bh2)) {
          const row = document.createElement("tr");

          const floorCell = document.createElement("td");
          floorCell.textContent = `${floorNum}${getOrdinalSuffix(
            floorNum
          )} Floor`;

          const roomsCell = document.createElement("td");
          const startRoom = (floorNum - 1) * 20 + 1;
          const endRoom = floorNum * 20;
          roomsCell.textContent = `${startRoom
            .toString()
            .padStart(3, "0")}-${endRoom.toString().padStart(3, "0")}`;

          const statusCell = document.createElement("td");
          statusCell.textContent =
            data.available > 0 ? "Available" : "Occupied";
          statusCell.className =
            data.available > 0 ? "room-available" : "room-occupied";

          row.appendChild(floorCell);
          row.appendChild(roomsCell);
          row.appendChild(statusCell);
          bh2Body.appendChild(row);

          floorNum++;
        }
      }

      // Helper function for ordinal suffixes
      function getOrdinalSuffix(num) {
        if (num % 10 === 1 && num % 100 !== 11) return "st";
        if (num % 10 === 2 && num % 100 !== 12) return "nd";
        if (num % 10 === 3 && num % 100 !== 13) return "rd";
        return "th";
      }

      // Update room availability based on allotments
      function updateRoomAvailability() {
        // Reset room availability
        for (const block of ["omv", "bh2"]) {
          for (const range of Object.keys(state.rooms[block])) {
            state.rooms[block][range].available =
              state.rooms[block][range].total;
          }
        }

        // Update based on allotments
        for (const allotment of state.allotments) {
          const block = allotment.hostelBlock;
          if (block === "omv") {
            // For OMV, find which range the room belongs to
            const roomNum = parseInt(allotment.roomNumber);
            let rangeKey = "";

            if (roomNum >= 1 && roomNum <= 20) rangeKey = "001-020";
            else if (roomNum >= 100 && roomNum <= 120) rangeKey = "100-120";
            else if (roomNum >= 200 && roomNum <= 220) rangeKey = "200-220";

            if (rangeKey && state.rooms.omv[rangeKey]) {
              state.rooms.omv[rangeKey].available--;
            }
          } else if (block === "bh2") {
            // For BH-2, find which floor the room belongs to
            const roomNum = parseInt(allotment.roomNumber);
            const floorNum = Math.ceil(roomNum / 20);
            const floorKey = `floor${floorNum}`;

            if (state.rooms.bh2[floorKey]) {
              state.rooms.bh2[floorKey].available--;
            }
          }
        }
      }

      // Update dashboard with user-specific information
      function updateDashboard() {
        if (!state.currentUser) return;

        document.getElementById(
          "welcome-message"
        ).textContent = `Welcome, ${state.currentUser.name}`;

        const registration = state.registrations.find(
          (r) => r.userId === state.currentUser.id
        );
        const allotment = state.allotments.find(
          (a) => a.userId === state.currentUser.id
        );

        const allocationStatus = document.getElementById("allocation-status");
        const roomDetails = document.getElementById("room-details");
        const roomNumber = document.getElementById("room-number");

        if (allotment) {
          allocationStatus.textContent = "Allotted";
          roomDetails.style.display = "block";
          roomNumber.textContent = allotment.roomNumber;
        } else if (registration) {
          allocationStatus.textContent = "Waiting";
          roomDetails.style.display = "none";
        } else {
          allocationStatus.textContent = "Not Registered";
          roomDetails.style.display = "none";
        }
      }

      // Update allotment result page
      function updateAllotmentResult() {
        if (!state.currentUser) return;

        const allotment = state.allotments.find(
          (a) => a.userId === state.currentUser.id
        );
        const allotmentMessage = document.getElementById("allotment-message");
        const allottedRoom = document.getElementById("allotted-room");
        const allottedRoomNumber = document.getElementById(
          "allotted-room-number"
        );
        const allottedHostelBlock = document.getElementById(
          "allotted-hostel-block"
        );
        const allottedRoomType = document.getElementById("allotted-room-type");

        if (allotment) {
          allotmentMessage.textContent =
            "Congratulations! You have been allotted a room.";
          allottedRoom.style.display = "block";
          allottedRoomNumber.textContent = allotment.roomNumber;
          allottedHostelBlock.textContent =
            allotment.hostelBlock === "omv" ? "OMV" : "BH-2";
          allottedRoomType.textContent = allotment.roomType;
        } else {
          allotmentMessage.textContent =
            "You have not been allotted a room yet.";
          allottedRoom.style.display = "none";
        }
      }

      // Update profile page
      function updateProfile() {
        if (!state.currentUser) return;

        document.getElementById("profile-name").textContent =
          state.currentUser.name;
        document.getElementById("profile-email").textContent =
          state.currentUser.email;
        document.getElementById("profile-gender").textContent =
          state.currentUser.gender;

        const registration = state.registrations.find(
          (r) => r.userId === state.currentUser.id
        );
        const allotment = state.allotments.find(
          (a) => a.userId === state.currentUser.id
        );

        const roomStatus = document.getElementById("profile-room-status");
        const roomDetails = document.getElementById("profile-room-details");
        const profileRoomNumber = document.getElementById(
          "profile-room-number"
        );

        if (allotment) {
          roomStatus.textContent = "Allotted";
          roomDetails.style.display = "block";
          profileRoomNumber.textContent = allotment.roomNumber;
        } else if (registration) {
          roomStatus.textContent = "Waiting";
          roomDetails.style.display = "none";
        } else {
          roomStatus.textContent = "Not Registered";
          roomDetails.style.display = "none";
        }
      }

      // Show edit profile modal
      function showEditProfileModal() {
        if (!state.currentUser) return;

        document.getElementById("edit-name").value = state.currentUser.name;
        document.getElementById("edit-email").value = state.currentUser.email;
        document.getElementById("edit-gender").value = state.currentUser.gender;

        editProfileModal.style.display = "flex";
      }

      // Handle edit profile
      function handleEditProfile(e) {
        e.preventDefault();

        const name = document.getElementById("edit-name").value;
        const email = document.getElementById("edit-email").value;
        const gender = document.getElementById("edit-gender").value;

        // Update user in state
        state.currentUser.name = name;
        state.currentUser.email = email;
        state.currentUser.gender = gender;

        // Update user in users array
        const userIndex = state.users.findIndex(
          (u) => u.id === state.currentUser.id
        );
        if (userIndex !== -1) {
          state.users[userIndex] = state.currentUser;
        }

        // Save to localStorage
        localStorage.setItem("currentUser", JSON.stringify(state.currentUser));
        localStorage.setItem("users", JSON.stringify(state.users));

        // Close modal and update profile
        editProfileModal.style.display = "none";
        updateProfile();
        updateDashboard();

        alert("Profile updated successfully!");
      }

      // Handle logout
      function handleLogout() {
        state.currentUser = null;
        localStorage.removeItem("currentUser");
        showPage("auth");
      }

      // Update admin panel
      function updateAdminPanel() {
        // Update registrations table
        const registrationsBody = document.getElementById(
          "admin-registrations-body"
        );
        registrationsBody.innerHTML = "";

        for (const registration of state.registrations) {
          const user = state.users.find((u) => u.id === registration.userId);
          if (user) {
            const row = document.createElement("tr");

            const nameCell = document.createElement("td");
            nameCell.textContent = user.name;

            const emailCell = document.createElement("td");
            emailCell.textContent = user.email;

            const blockCell = document.createElement("td");
            blockCell.textContent =
              registration.hostelBlock === "omv" ? "OMV" : "BH-2";

            const typeCell = document.createElement("td");
            typeCell.textContent = registration.roomType;

            const statusCell = document.createElement("td");
            statusCell.textContent = registration.status;

            row.appendChild(nameCell);
            row.appendChild(emailCell);
            row.appendChild(blockCell);
            row.appendChild(typeCell);
            row.appendChild(statusCell);

            registrationsBody.appendChild(row);
          }
        }

        // Update allotments table
        const allotmentsBody = document.getElementById("admin-allotments-body");
        allotmentsBody.innerHTML = "";

        for (const allotment of state.allotments) {
          const user = state.users.find((u) => u.id === allotment.userId);
          if (user) {
            const row = document.createElement("tr");

            const nameCell = document.createElement("td");
            nameCell.textContent = user.name;

            const emailCell = document.createElement("td");
            emailCell.textContent = user.email;

            const blockCell = document.createElement("td");
            blockCell.textContent =
              allotment.hostelBlock === "omv" ? "OMV" : "BH-2";

            const typeCell = document.createElement("td");
            typeCell.textContent = allotment.roomType;

            const roomCell = document.createElement("td");
            roomCell.textContent = allotment.roomNumber;

            row.appendChild(nameCell);
            row.appendChild(emailCell);
            row.appendChild(blockCell);
            row.appendChild(typeCell);
            row.appendChild(roomCell);

            allotmentsBody.appendChild(row);
          }
        }
      }

      // Handle room allotment
      function handleAllotRooms() {
        // Clear previous allotments
        state.allotments = [];

        // Process registrations in order
        for (const registration of state.registrations) {
          const block = registration.hostelBlock;
          let roomAssigned = false;

          if (block === "omv") {
            // Assign room in OMV
            for (const [range, data] of Object.entries(state.rooms.omv)) {
              if (data.available > 0) {
                // Find an available room in this range
                let startRoom, endRoom;

                if (range === "001-020") {
                  startRoom = 1;
                  endRoom = 20;
                } else if (range === "100-120") {
                  startRoom = 100;
                  endRoom = 120;
                } else if (range === "200-220") {
                  startRoom = 200;
                  endRoom = 220;
                }

                // Find first available room in range
                for (let roomNum = startRoom; roomNum <= endRoom; roomNum++) {
                  const roomStr = roomNum.toString().padStart(3, "0");
                  const isRoomTaken = state.allotments.some(
                    (a) => a.hostelBlock === "omv" && a.roomNumber === roomStr
                  );

                  if (!isRoomTaken) {
                    // Assign this room
                    const allotment = {
                      id: Date.now().toString() + Math.random(),
                      userId: registration.userId,
                      hostelBlock: "omv",
                      roomType: registration.roomType,
                      roomNumber: roomStr,
                    };

                    state.allotments.push(allotment);
                    roomAssigned = true;
                    break;
                  }
                }

                if (roomAssigned) break;
              }
            }
          } else if (block === "bh2") {
            // Assign room in BH-2
            for (const [floor, data] of Object.entries(state.rooms.bh2)) {
              if (data.available > 0) {
                // Find an available room on this floor
                const floorNum = parseInt(floor.replace("floor", ""));
                const startRoom = (floorNum - 1) * 20 + 1;
                const endRoom = floorNum * 20;

                // Find first available room on floor
                for (let roomNum = startRoom; roomNum <= endRoom; roomNum++) {
                  const roomStr = roomNum.toString().padStart(3, "0");
                  const isRoomTaken = state.allotments.some(
                    (a) => a.hostelBlock === "bh2" && a.roomNumber === roomStr
                  );

                  if (!isRoomTaken) {
                    // Assign this room
                    const allotment = {
                      id: Date.now().toString() + Math.random(),
                      userId: registration.userId,
                      hostelBlock: "bh2",
                      roomType: registration.roomType,
                      roomNumber: roomStr,
                    };

                    state.allotments.push(allotment);
                    roomAssigned = true;
                    break;
                  }
                }

                if (roomAssigned) break;
              }
            }
          }

          // Update registration status
          if (roomAssigned) {
            registration.status = "allotted";
          } else {
            registration.status = "waiting (no rooms available)";
          }
        }

        // Save to localStorage
        localStorage.setItem("allotments", JSON.stringify(state.allotments));
        localStorage.setItem(
          "registrations",
          JSON.stringify(state.registrations)
        );

        // Update room availability
        updateRoomAvailability();

        // Show success message
        const messageDiv = document.getElementById("allotment-result-message");
        messageDiv.textContent = `Rooms allotted successfully! ${state.allotments.length} students received rooms.`;
        messageDiv.style.display = "block";

        // Update admin panel
        updateAdminPanel();
      }

      // --- CHATBOT LOGIC (NOW WITH OPENROUTER API) ---

      async function handleChatMessage() {
        const userMessage = chatbotInputField.value.trim();
        if (!userMessage) return;

        addMessageToChat("user", userMessage);
        chatbotInputField.value = "";

        // Show typing indicator
        const typingIndicator = addMessageToChat("bot", "typing");

        try {
          // Get AI response
          const botResponse = await getOpenRouterResponse(userMessage);

          // Remove typing indicator and add final response
          typingIndicator.remove();
          addMessageToChat("bot", botResponse);
        } catch (error) {
          // Handle errors
          typingIndicator.remove();
          addMessageToChat(
            "bot",
            "Sorry, I'm having trouble connecting to the AI. Please check the API key and try again."
          );
          console.error("Chatbot API Error:", error);
        }
      }

      function addMessageToChat(sender, message) {
        const messageElement = document.createElement("div");
        messageElement.classList.add("chat-message", sender);

        if (message === "typing") {
          // Create typing indicator
          const typingDiv = document.createElement("div");
          typingDiv.classList.add("typing-indicator");
          typingDiv.innerHTML = "<span></span><span></span><span></span>";
          messageElement.appendChild(typingDiv);
        } else {
          // Create standard message bubble
          const messageContent = document.createElement("div");
          messageContent.classList.add("message");
          messageContent.textContent = message;
          messageElement.appendChild(messageContent);
        }

        chatbotMessages.appendChild(messageElement);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        return messageElement; // Return the element so it can be removed if needed
      }

      async function getOpenRouterResponse(userMessage) {
        if (
          OPENROUTER_API_KEY === "REPLACE_WITH_YOUR_OPENROUTER_KEY" ||
          !OPENROUTER_API_KEY
        ) {
          return "Please add your OpenRouter API key in the script to enable the AI chatbot.";
        }

        // Add user message to history
        state.chatHistory.push({ role: "user", content: userMessage });

        // Provide context to the AI model
        const systemPrompt = `You are a friendly and helpful assistant for a Hostel Room Allocation System. Your name is Hostel Helper. You can answer questions about hostel registration, room availability, and allocation status. Keep your answers concise and helpful. Current Date: ${new Date().toLocaleDateString()}`;

        let userContext = "";
        if (state.currentUser) {
          const allotment = state.allotments.find(
            (a) => a.userId === state.currentUser.id
          );
          const registration = state.registrations.find(
            (r) => r.userId === state.currentUser.id
          );
          userContext += `The user, ${state.currentUser.name}, is currently logged in. `;
          if (allotment) {
            userContext += `They have been allotted Room ${
              allotment.roomNumber
            } in ${allotment.hostelBlock.toUpperCase()}. `;
          } else if (registration) {
            userContext += `They have registered and their status is 'Waiting'. `;
          } else {
            userContext += `They have not registered for a room yet. `;
          }
        } else {
          userContext += "The user is not currently logged in. ";
        }

        const messages = [
          { role: "system", content: systemPrompt + userContext },
          ...state.chatHistory, // Include past conversation for context
        ];

        const response = await fetch(
          "https://openrouter.ai/api/v1/chat/completions",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${OPENROUTER_API_KEY}`,
              "HTTP-Referer": "http://localhost", // Required by OpenRouter
              "X-Title": "Hostel Allocation Bot", // Optional
            },
            body: JSON.stringify({
              model: "google/gemma-7b-it:free", // Using a valid free model from Google
              messages: messages,
            }),
          }
        );

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(
            `API Error: ${response.status} ${response.statusText} - ${errorData.error.message}`
          );
        }

        const data = await response.json();
        const botMessage = data.choices[0].message.content;

        // Add bot's response to history
        state.chatHistory.push({ role: "assistant", content: botMessage });

        return botMessage;
      }

      // Initialize the application when DOM is loaded
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>